<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tra đơn order W25 HLE Bống Dung</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
  --bg:#0f1724;
  --card:#161c2e;
  --muted:#9aa4b2;
  --accent:#f97316;
  --glass:rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
body{
  font-family:Montserrat,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
  margin:0;
  background:linear-gradient(180deg,#0b0f1a 0%, #111827 100%);
  color:#e6eef6;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
}
.container{width:100%;max-width:720px}
.card{background:var(--card);border-radius:12px;padding:20px;box-shadow:0 6px 24px rgba(2,6,23,0.6);}
h1{font-size:18px;margin:0;color:var(--accent);line-height:1.4;text-align:center}
.searchbar{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
  margin-top:12px
}
input[type=text]{
  flex:1;
  min-width:180px;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.06);
  background:var(--glass);
  color:inherit;
  font-size:14px
}
button{
  padding:10px 14px;
  border-radius:8px;
  border:0;
  background:linear-gradient(90deg,var(--accent),#fb923c);
  color:white;
  font-weight:600;
  cursor:pointer;
  flex-shrink:0;
}
#clearBtn{
  background:transparent;
  border:1px solid rgba(255,255,255,0.2);
  color:#e6eef6
}
.note{color:var(--muted);font-size:13px;margin-top:8px;text-align:center}
.result{margin-top:16px}
.name a{color:var(--accent);text-decoration:none;font-weight:600}
.section-title{font-weight:700;margin-top:14px;margin-bottom:6px;color:var(--accent)}
.summary{background:rgba(249,115,22,0.08);padding:10px;border-radius:8px;color:var(--muted)}
.details{margin-top:10px;border-left:3px solid rgba(249,115,22,0.3);padding-left:12px}
.line{display:flex;flex-wrap:wrap;gap:6px;align-items:flex-start;margin-bottom:8px}
.label{flex:0 0 120px;color:var(--muted);font-weight:600}
.value{flex:1;min-width:120px;white-space:pre-wrap}
.small{font-size:13px;color:var(--muted)}

/* Responsive tweaks */
@media(max-width:600px){
  h1{font-size:16px}
  input[type=text]{flex:1 1 100%;font-size:13px}
  button{flex:1 1 auto;font-size:13px;padding:8px}
  .label{flex:0 0 100px}
  .card{padding:16px}
}
@media(max-width:400px){
  .label{flex:0 0 100%;margin-bottom:2px}
  .line{flex-direction:column;align-items:flex-start}
  input[type=text]{min-width:100%}
  button{width:100%}
}

  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Tra đơn order W25 HLE Bống Dung</h1>
      <div class="searchbar">
        <input id="phoneInput" type="text" placeholder="Nhập số điện thoại (ví dụ: 0987654321)" />
        <button id="searchBtn">Tìm</button>
        <button id="clearBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#e6eef6">Xóa</button>
      </div>
      <div class="note">Nhập số điện thoại (so sánh chỉ chữ số). Nếu có nhiều đơn, tất cả sẽ hiển thị.</div>

      <div id="result" class="result"></div>
    </div>
  </div>

<script>
// -- CONFIG --
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRfvqOsaXLMUOgh3lAArd-h4HQcS-rba4EJLaCP-wgP3pbIe4oVq2ZOms79HyB6F3aiqBt_nCO0dvWm/pub?gid=57038965&single=true&output=csv';

// Column indexes (0-based)
const COL = {
  phone:1, fbName:2, fbLink:3,
  jacketQty:5, jacketDetail:6,
  jerseyBlackQty:7, jerseyBlackDetail:8,
  jerseyOrangeQty:9, jerseyOrangeDetail:10,
  muffleQty:11,               // L
  keyringMiniQty:12,          // M
  keyringBlackUni:13,         // N (text)
  amountPaid:14,              // O
  note:16                     // Q
};

function parseCSV(text){
  const rows = [];
  let cur = [], field='', inQuotes=false;
  for(let i=0;i<text.length;i++){
    const ch=text[i];
    if(inQuotes){
      if(ch==='"'){
        if(i+1<text.length && text[i+1]==='"'){ field+='"'; i++; }
        else inQuotes=false;
      } else field+=ch;
    } else {
      if(ch==='"') inQuotes=true;
      else if(ch===','){ cur.push(field); field=''; }
      else if(ch==='\n'){ cur.push(field); rows.push(cur); cur=[]; field=''; }
      else if(ch!=='\r') field+=ch;
    }
  }
  if(field!==''||cur.length>0){cur.push(field);rows.push(cur);}
  return rows;
}

// --- chuẩn hóa số điện thoại ---
// --- chuẩn hóa số điện thoại ---
// Cho phép: +84xxxxxxxxx | 84xxxxxxxxx | 0xxxxxxxxx | xxxxxxxxx
function normalizePhone(s){
  let digits = (s||'').toString().replace(/[^0-9]/g,''); // chỉ giữ số

  // Nếu có +84 ở đầu (vd: +84987654321)
  if((s||'').startsWith('+84')){
    digits = '0' + digits.slice(2); // bỏ 84 → thêm 0
  }
  // Nếu có 84 ở đầu (vd: 84987654321)
  else if(digits.startsWith('84')){
    digits = '0' + digits.slice(2);
  }
  // Nếu không có gì (vd: 987654321) thì thêm 0
  else if(digits.length === 9){
    digits = '0' + digits;
  }
  // Nếu đã bắt đầu bằng 0 thì giữ nguyên
  // digits = "0xxxxxxxxx"
  
  return digits;
}



function htmlEscape(s){ return (s||'').replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c])); }

async function loadAndSearch(phoneRaw){
  const root=document.getElementById('result');
  root.innerHTML='<div class="small">Đang tải dữ liệu...</div>';
  try{
    const resp=await fetch(CSV_URL);
    const txt=await resp.text();
    const rows=parseCSV(txt).slice(1);
    const target=normalizePhone(phoneRaw);
    const matches=rows.filter(r=>normalizePhone(r[COL.phone])===target);
    if(matches.length===0){root.innerHTML='<div class="small">Không tìm thấy đơn nào</div>';return;}
    let out='';
    matches.forEach(r=>{
      const fbName=r[COL.fbName]||'(No name)';
      const fbLink=r[COL.fbLink]||'';
      const jacketQty=+r[COL.jacketQty]||0, jacketDetail=r[COL.jacketDetail]||'';
      const jerseyBlackQty=+r[COL.jerseyBlackQty]||0, jerseyBlackDetail=r[COL.jerseyBlackDetail]||'';
      const jerseyOrangeQty=+r[COL.jerseyOrangeQty]||0, jerseyOrangeDetail=r[COL.jerseyOrangeDetail]||'';
      const muffleQty=+r[COL.muffleQty]||0;
      const keyringMiniQty=+r[COL.keyringMiniQty]||0;
      const keyringBlackUni=(r[COL.keyringBlackUni]||'').trim();
      const amountPaid=r[COL.amountPaid]||'';
      const note=r[COL.note]||'';

      out+='<div class="card" style="margin-top:16px">';
      out+='<div class="name">'+(fbLink?'<a href="'+htmlEscape(fbLink)+'" target="_blank">'+htmlEscape(fbName)+'</a>':htmlEscape(fbName))+'</div>';
      out+='<div class="small">SĐT: '+htmlEscape(r[COL.phone]||'')+'</div>';

      // Summary
      const parts=[];
      if(jacketQty>0) parts.push(jacketQty+' jacket');
      if(jerseyBlackQty>0) parts.push(jerseyBlackQty+' jersey đen');
      if(jerseyOrangeQty>0) parts.push(jerseyOrangeQty+' jersey cam');
      if(muffleQty>0) parts.push(muffleQty+' muffle');
      if(keyringMiniQty>0) parts.push(keyringMiniQty+' keyring mini scarf');
      if(keyringBlackUni) parts.push('keyring black uni');
      if(parts.length>0) out+='<div class="summary"><strong>Summary:</strong> '+htmlEscape(parts.join(', '))+'</div>';

      // Details
      out+='<div class="details">';
      if(jacketQty>0) out+='<div class="line"><div class="label">Jacket</div><div class="value">'+htmlEscape(jacketDetail)+'</div></div>';
      if(jerseyBlackQty>0) out+='<div class="line"><div class="label">Jersey đen</div><div class="value">'+htmlEscape(jerseyBlackDetail)+'</div></div>';
      if(jerseyOrangeQty>0) out+='<div class="line"><div class="label">Jersey cam</div><div class="value">'+htmlEscape(jerseyOrangeDetail)+'</div></div>';
      if(muffleQty>0) out+='<div class="line"><div class="label">Muffle</div><div class="value">'+muffleQty+'</div></div>';
      if(keyringMiniQty>0) out+='<div class="line"><div class="label">Keyring Mini Scarf</div><div class="value">'+keyringMiniQty+'</div></div>';
      if(keyringBlackUni) out+='<div class="line"><div class="label">Keyring Black Uni</div><div class="value">'+htmlEscape(keyringBlackUni)+'</div></div>';
      out+='<div class="line"><div class="label">Số tiền đã chuyển</div><div class="value">'+htmlEscape(amountPaid||'(chưa có)')+'</div></div>';
      if(note) out+='<div class="line"><div class="label">Ghi chú</div><div class="value">'+htmlEscape(note)+'</div></div>';
      out+='</div></div>';
    });
    root.innerHTML=out;
  }catch(e){root.innerHTML='<div class="small">Lỗi: '+htmlEscape(e.message)+'</div>';}
}

document.getElementById('searchBtn').onclick=()=>{loadAndSearch(document.getElementById('phoneInput').value)};
document.getElementById('clearBtn').onclick=()=>{document.getElementById('phoneInput').value='';document.getElementById('result').innerHTML='';};
</script>

</body>
</html>
