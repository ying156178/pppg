<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tra đơn order W25 HLE Bống Dung theo số điện thoại</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724;
      --card:#161c2e;
      --muted:#9aa4b2;
      --accent:#f97316;
      --glass:rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    body{
      font-family:Montserrat,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
      margin:0;
      background:linear-gradient(180deg,#0b0f1a 0%, #111827 100%);
      color:#e6eef6;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .container{width:100%;max-width:600px;text-align:center}
    h1{font-size:20px;margin-bottom:6px;color:var(--accent)}
    .card{background:var(--card);border-radius:12px;padding:20px;box-shadow:0 6px 24px rgba(2,6,23,0.6);}
    .controls{display:flex;gap:8px;align-items:center;justify-content:center;margin-bottom:10px}
    input[type=text]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);color:inherit;font-size:14px;min-width:0}
    button{padding:10px 14px;border-radius:8px;border:0;background:linear-gradient(90deg,var(--accent),#fb923c);color:white;font-weight:600;cursor:pointer;white-space:nowrap}
    .note{color:var(--muted);font-size:13px;margin-top:8px}
    .result{margin-top:16px;text-align:left}
    .name a{color:var(--accent);text-decoration:none;font-weight:600}
    .section-title{font-weight:700;margin-top:14px;margin-bottom:6px;color:var(--accent)}
    .summary{background:rgba(249,115,22,0.08);padding:10px;border-radius:8px;color:var(--muted)}
    .details{margin-top:10px;border-left:3px solid rgba(249,115,22,0.3);padding-left:12px}
    .line{display:flex;gap:8px;align-items:flex-start;margin-bottom:8px}
    .label{min-width:120px;color:var(--muted);font-weight:600}
    .value{white-space:pre-wrap}
    .css-sep{height:1px;background:rgba(255,255,255,0.05);margin:14px 0;border-radius:2px}
    .small{font-size:13px;color:var(--muted)}
    @media(max-width:600px){
      .label{min-width:100px}
      .controls{flex-direction:column}
      input[type=text]{width:100%}
      button{width:100%}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tra đơn order W25 HLE Bống Dung</h1>
    <div class="small">Nhập số điện thoại (chỉ số)</div>

    <div class="card">
      <div class="controls">
        <input id="phoneInput" type="text" placeholder="Ví dụ: 0987654321" />
        <button id="searchBtn">Tìm</button>
        <button id="clearBtn" style="background:transparent;border:1px solid rgba(255,255,255,0.2);color:#e6eef6">Xóa</button>
      </div>

      <div id="result" class="result"></div>

      <div class="css-sep"></div>
      <div class="small">Trang sẽ tìm tất cả đơn có số điện thoại trùng khớp (chỉ chữ số).</div>
    </div>
  </div>

<script>
// -- CONFIG --
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRfvqOsaXLMUOgh3lAArd-h4HQcS-rba4EJLaCP-wgP3pbIe4oVq2ZOms79HyB6F3aiqBt_nCO0dvWm/pub?gid=57038965&single=true&output=csv';

// Column indexes (0-based)
const COL = {
  phone:1, fbName:2, fbLink:3,
  jacketQty:5, jacketDetail:6,
  jerseyBlackQty:7, jerseyBlackDetail:8,
  jerseyOrangeQty:9, jerseyOrangeDetail:10,
  muffleQty:11,            // L
  keyringMiniQty:12,       // M
  keyringBlackUniQty:13,   // N
  amountPaid:14,           // O
  note:16                  // Q
};

function parseCSV(text){
  const rows=[]; let cur=[]; let field=''; let inQuotes=false;
  for(let i=0;i<text.length;i++){
    const ch=text[i];
    if(inQuotes){
      if(ch==='"'){
        if(i+1<text.length && text[i+1]==='"'){field+='"';i++;continue;}
        inQuotes=false;continue;
      } else {field+=ch;continue;}
    }
    if(ch==='"'){inQuotes=true;continue;}
    if(ch===','){cur.push(field);field='';continue;}
    if(ch==='\r')continue;
    if(ch==='\n'){cur.push(field);rows.push(cur);cur=[];field='';continue;}
    field+=ch;
  }
  if(field!==''||cur.length)cur.push(field);
  if(cur.length)rows.push(cur);
  return rows;
}
const onlyDigits=s=>(s||'').toString().replace(/\D/g,'');
const htmlEscape=s=>(s||'').toString().replace(/[&<>]/g,ch=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[ch]));

async function loadAndSearch(phoneRaw){
  const root=document.getElementById('result');
  root.innerHTML='<div class="small">Đang tải dữ liệu...</div>';
  try{
    const resp=await fetch(CSV_URL);
    if(!resp.ok) throw new Error('Không tải được CSV: '+resp.status);
    const rows=parseCSV(await resp.text());
    if(rows.length<=1){root.innerHTML='<div class="small">CSV rỗng</div>';return;}
    const data=rows.slice(1);
    const target=onlyDigits(phoneRaw);
    const matches=data.filter(r=>onlyDigits(r[COL.phone])===target);
    if(!matches.length){root.innerHTML='<div class="small">Không tìm thấy đơn nào cho số: '+htmlEscape(phoneRaw)+'</div>';return;}

    let out='';
    matches.forEach(r=>{
      const fbName=r[COL.fbName]||'(No name)';
      const fbLink=r[COL.fbLink]||'';
      const jacketQty=+(r[COL.jacketQty]||0);
      const jacketDetail=r[COL.jacketDetail]||'';
      const jerseyBlackQty=+(r[COL.jerseyBlackQty]||0);
      const jerseyBlackDetail=r[COL.jerseyBlackDetail]||'';
      const jerseyOrangeQty=+(r[COL.jerseyOrangeQty]||0);
      const jerseyOrangeDetail=r[COL.jerseyOrangeDetail]||'';
      const muffleQty=+(r[COL.muffleQty]||0);
      const keyringMiniQty=+(r[COL.keyringMiniQty]||0);
      const keyringBlackUniQty=+(r[COL.keyringBlackUniQty]||0);
      const amountPaid=r[COL.amountPaid]||'';
      const note=r[COL.note]||'';

      out+='<div class="card" style="margin-top:12px">';
      out+='<div class="name">';
      if(fbLink){out+='<div><a href="'+htmlEscape(fbLink)+'" target="_blank">'+htmlEscape(fbName)+'</a></div>';}
      else {out+='<div>'+htmlEscape(fbName)+'</div>';}
      out+='<div class="small">SĐT: '+htmlEscape(r[COL.phone]||'')+'</div></div>';

      // summary
      const parts=[];
      if(jacketQty>0)parts.push(jacketQty+' jacket');
      if(jerseyBlackQty>0)parts.push(jerseyBlackQty+' jersey đen');
      if(jerseyOrangeQty>0)parts.push(jerseyOrangeQty+' jersey cam');
      if(muffleQty>0)parts.push(muffleQty+' muffle');
      if(keyringMiniQty>0)parts.push(keyringMiniQty+' keyring mini scarf');
      if(keyringBlackUniQty>0)parts.push(keyringBlackUniQty+' keyring black uni');
      if(parts.length)out+='<div class="summary"><strong>Summary:</strong> '+htmlEscape(parts.join(', '))+'</div>';

      // details
      out+='<div class="details">';
      if(jacketQty>0)out+='<div class="line"><div class="label">Jacket</div><div class="value">'+htmlEscape(jacketDetail||'(no detail)')+'</div></div>';
      if(jerseyBlackQty>0)out+='<div class="line"><div class="label">Jersey đen</div><div class="value">'+htmlEscape(jerseyBlackDetail||'(no detail)')+'</div></div>';
      if(jerseyOrangeQty>0)out+='<div class="line"><div class="label">Jersey cam</div><div class="value">'+htmlEscape(jerseyOrangeDetail||'(no detail)')+'</div></div>';
      if(muffleQty>0)out+='<div class="line"><div class="label">Muffle</div><div class="value">'+muffleQty+'</div></div>';
      if(keyringMiniQty>0)out+='<div class="line"><div class="label">Keyring Mini Scarf</div><div class="value">'+keyringMiniQty+'</div></div>';
      if(keyringBlackUniQty>0)out+='<div class="line"><div class="label">Keyring Black Uni</div><div class="value">'+keyringBlackUniQty+'</div></div>';
      out+='<div class="line"><div class="label">Số tiền đã chuyển</div><div class="value">'+htmlEscape(amountPaid||'(chưa có)')+'</div></div>';
      if(note)out+='<div class="line"><div class="label">Ghi chú</div><div class="value">'+htmlEscape(note)+'</div></div>';
      out+='</div></div>';
    });
    root.innerHTML=out;
  }catch(e){root.innerHTML='<div class="small">Lỗi: '+htmlEscape(e.message)+'</div>';}
}

document.getElementById('searchBtn').onclick=()=>loadAndSearch(document.getElementById('phoneInput').value);
document.getElementById('clearBtn').onclick=()=>{document.getElementById('phoneInput').value='';document.getElementById('result').innerHTML='';};
</script>
</body>
</html>
