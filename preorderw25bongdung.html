<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tra cứu Pre-order W25 HLE - Bống Dung</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f0f0f;
      --card: #1a1a1a;
      --muted: #aaa;
      --accent: #d4af37; /* vàng kim */
      --glass: rgba(255,255,255,0.05);
    }
    * { box-sizing: border-box; }
    body {
      font-family: Montserrat, sans-serif;
      margin: 0;
      background: linear-gradient(180deg, #0b0b0b, #141414 100%);
      color: #f0f0f0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }
    .container { width: 100%; max-width: 720px; }
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.7);
      border: 1px solid rgba(212,175,55,0.3);
    }
    h1 {
      font-size: 20px;
      margin: 0;
      color: var(--accent);
      text-align: center;
      font-weight: 700;
    }
    .searchbar {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 16px;
      flex-wrap: wrap; /* cho phép xuống hàng */
    }

    @media (max-width: 600px) {
      .searchbar {
        flex-direction: column;  /* dọc trên mobile */
        align-items: stretch;
    }
  .searchbar input,
  .searchbar button {
    width: 100%;   /* nút và input full width */
  }
}

    input[type=tel] {
      flex: 1;
      min-width: 180px;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--glass);
      color: #fff;
      font-size: 15px;
    }
    button {
      padding: 12px 16px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: #000;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover { opacity: 0.9; }
    #clearBtn, #refreshBtn {
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
    }
    .note {
      color: var(--muted);
      font-size: 13px;
      margin-top: 8px;
      text-align: center;
    }
    .result { margin-top: 20px; }
    .name a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }
    .section-title { font-weight: 700; margin-top: 12px; margin-bottom: 6px; color: var(--accent); }
    .details { margin-top: 10px; border-left: 3px solid rgba(212,175,55,0.4); padding-left: 12px; }
    .line { margin-bottom: 8px; }
    .label { font-weight: 600; color: var(--muted); margin-bottom: 2px; }
    .value { white-space: pre-wrap; }
    .small { font-size: 13px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Tra cứu Pre-order W25 HLE - Bống Dung</h1>
      <div class="searchbar">
        <input id="phoneInput" type="tel" inputmode="numeric" placeholder="Nhập số điện thoại..." />
        <button id="searchBtn">Tìm</button>
        <button id="refreshBtn">Refresh</button>
        <button id="clearBtn">Xóa</button>
      </div>
      <div class="note">Hỗ trợ định dạng: 0xxxxxxxxx, xxxxxxxxx, 84xxxxxxxxx, +84xxxxxxxxx, 0084xxxxxxxxx</div>
      <div id="result" class="result"></div>
    </div>
  </div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS68LmtizleGjeH66aUUo9B2YC75ye4ZjfIfjR7lCe17JPAXqisC_FKkoLtVpfsUtwvLs0yObWmIdM4/pub?gid=272659167&single=true&output=csv";

const COL = {
  phone: 1, fbName: 2, fbLink: 3,
  jacketQty: 5, jacketDetail: 6,
  jerseyBlackQty: 7, jerseyBlackDetail: 8,
  jerseyOrangeQty: 9, jerseyOrangeDetail: 10,
  muffler: 11, keyringUni: 12, keyringScarf: 13,
  marking: 14, amountPaid: 15, note: 17
};

function parseCSV(text){
  const rows=[]; let cur=[], field='', inQuotes=false;
  for(let i=0;i<text.length;i++){
    const ch=text[i];
    if(inQuotes){
      if(ch==='"'){
        if(i+1<text.length && text[i+1]==='"'){ field+='"'; i++; }
        else inQuotes=false;
      } else field+=ch;
    } else {
      if(ch==='"') inQuotes=true;
      else if(ch===','){ cur.push(field); field=''; }
      else if(ch==='\n'){ cur.push(field); rows.push(cur); cur=[]; field=''; }
      else if(ch!=='\r') field+=ch;
    }
  }
  if(field!==''||cur.length>0){ cur.push(field); rows.push(cur); }
  return rows;
}

function normalizePhone(s){
  let digits = (s||'').replace(/\D/g,'');
  if((s||'').startsWith('+84')) digits = '0'+digits.slice(2);
  else if(digits.startsWith('84')) digits = '0'+digits.slice(2);
  else if(digits.startsWith('0084')) digits = '0'+digits.slice(4);
  else if(digits.length===9) digits = '0'+digits;
  return digits;
}
function htmlEscape(s){ return (s||'').replace(/[&<>]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[c])); }

async function loadAndSearch(phoneRaw){
  const root=document.getElementById('result');
  root.innerHTML='<div class="small">Đang tải dữ liệu...</div>';
  try {
    const resp=await fetch(CSV_URL+'&_ts='+Date.now());
    const txt=await resp.text();
    const rows=parseCSV(txt).slice(1);
    const target=normalizePhone(phoneRaw);
    const matches=rows.filter(r=>normalizePhone(r[COL.phone])===target);
    if(matches.length===0){ root.innerHTML='<div class="small">Không tìm thấy đơn nào</div>'; return; }
    let out='';
    matches.forEach(r=>{
      out+=`<div class="card" style="margin-top:16px">
        <div class="name">${r[COL.fbLink]?`<a href="${htmlEscape(r[COL.fbLink])}" target="_blank">${htmlEscape(r[COL.fbName])}</a>`:htmlEscape(r[COL.fbName])}</div>
        <div class="small">SĐT: ${htmlEscape(r[COL.phone])}</div>
        <div class="details">`;
      if(r[COL.jacketQty]) out+=`<div class="line"><div class="label">Jacket</div><div class="value">${r[COL.jacketQty]} - ${htmlEscape(r[COL.jacketDetail])}</div></div>`;
      if(r[COL.jerseyBlackQty]) out+=`<div class="line"><div class="label">Jersey Đen</div><div class="value">${r[COL.jerseyBlackQty]} - ${htmlEscape(r[COL.jerseyBlackDetail])}</div></div>`;
      if(r[COL.jerseyOrangeQty]) out+=`<div class="line"><div class="label">Jersey Cam</div><div class="value">${r[COL.jerseyOrangeQty]} - ${htmlEscape(r[COL.jerseyOrangeDetail])}</div></div>`;
      if(r[COL.muffler]) out+=`<div class="line"><div class="label">Muffler</div><div class="value">${htmlEscape(r[COL.muffler])}</div></div>`;
      if(r[COL.keyringUni]) out+=`<div class="line"><div class="label">Keyring Uni</div><div class="value">${htmlEscape(r[COL.keyringUni])}</div></div>`;
      if(r[COL.keyringScarf]) out+=`<div class="line"><div class="label">Keyring Khăn</div><div class="value">${htmlEscape(r[COL.keyringScarf])}</div></div>`;
      if(r[COL.marking]) out+=`<div class="line"><div class="label">Marking lẻ</div><div class="value">${htmlEscape(r[COL.marking])}</div></div>`;
      if(r[COL.amountPaid]) out+=`<div class="line"><div class="label">Đã chuyển</div><div class="value">${htmlEscape(r[COL.amountPaid])}</div></div>`;
      if(r[COL.note]) out+=`<div class="line"><div class="label">Ghi chú</div><div class="value">${htmlEscape(r[COL.note])}</div></div>`;
      out+='</div></div>';
    });
    root.innerHTML=out;
  } catch(e){
    root.innerHTML='<div class="small">Lỗi tải dữ liệu: '+htmlEscape(e.message)+'</div>';
  }
}

document.getElementById('searchBtn').onclick=()=>loadAndSearch(document.getElementById('phoneInput').value);
document.getElementById('clearBtn').onclick=()=>{document.getElementById('phoneInput').value='';document.getElementById('result').innerHTML='';};
document.getElementById('refreshBtn').onclick=()=>{ if(document.getElementById('phoneInput').value) loadAndSearch(document.getElementById('phoneInput').value); };
</script>
</body>
</html>
